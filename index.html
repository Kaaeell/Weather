<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Weather Forecast - Real-time Weather Updates Worldwide</title>
    
   
    <meta name='description' itemprop='description' content='Velixs is a leading platform that provides website development services and various resourceful tools tailored to meet the needs of developers.'>
<link rel="canonical" href="https://ryzxell-weather.vercel.app">

<meta property="og:title" content="Weather-Kaell">
<meta property="og:description" content="Velixs is a leading platform that provides website development services and various resourceful tools tailored to meet the needs of developers.">
<meta property="og:url" content="https://ryzxell-weather.vercel.app">
<meta property="og:type" content="website">
<meta property="og:image" content="https://files.catbox.moe/c5q2hm.webp
    
    
    
    <!-- PWA Support -->
    <link rel="manifest" href="#manifest">
    <meta name="theme-color" content="#5D5CDE">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Weather App">
    <link rel="apple-touch-icon" href="https://files.catbox.moe/c5q2hm.webp">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%235D5CDE' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z'/%3E%3C/svg%3E">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#3B82F6',
                        dark: {
                            bg: '#181818',
                            card: '#252525',
                            text: '#E1E1E1'
                        }
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                },
            }
        }

        // Check for dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Global Weather Forecast",
      "url": "https://globalweatherforecast.com",
      "description": "Get accurate real-time weather forecasts for any location worldwide.",
      "applicationCategory": "Weather",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
</head>
<body class="bg-gray-100 dark:bg-dark-bg text-gray-800 dark:text-dark-text min-h-screen transition-colors duration-200">
    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-card shadow-lg p-4 z-50 transform transition-transform duration-300 translate-y-full">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div class="bg-primary p-2 rounded-lg mr-3">
                    <i class="fas fa-cloud-sun text-white text-xl"></i>
                </div>
                <div>
                    <h3 class="font-semibold">Install Weather App</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Get faster access and offline features</p>
                </div>
            </div>
            <div class="flex">
                <button id="pwa-cancel" class="px-3 py-1 mr-2 text-gray-700 dark:text-gray-300">Not Now</button>
                <button id="pwa-install" class="px-4 py-1 bg-primary text-white rounded-lg">Install</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="mb-10">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <i class="fas fa-cloud-sun text-primary text-3xl mr-3"></i>
                    <h1 class="text-3xl md:text-4xl font-bold">Global Weather Forecast</h1>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="install-app-btn" class="hidden px-3 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition flex items-center">
                        <i class="fas fa-download mr-2"></i> Install App
                    </button>
                    <button id="location-btn" class="px-3 py-2 bg-gray-200 dark:bg-dark-card rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 transition" title="Use current location">
                        <i class="fas fa-location-arrow"></i>
                    </button>
                    <button id="share-btn" class="px-3 py-2 bg-gray-200 dark:bg-dark-card rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 transition" title="Share forecast">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button id="toggle-mode" class="px-3 py-2 bg-gray-200 dark:bg-dark-card rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 transition" title="Toggle dark/light mode">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                </div>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mt-2 text-center md:text-left">Real-time weather forecasts for any location worldwide</p>
        </header>

        <!-- Search box -->
        <div class="bg-white dark:bg-dark-card rounded-lg shadow-md p-6 mb-8">
            <form id="search-form" class="flex flex-col md:flex-row gap-3">
                <div class="flex-grow">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input 
                            type="text" 
                            id="location-input" 
                            placeholder="Enter city name (e.g., Tokyo, Paris, New York)" 
                            class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 text-base bg-white dark:bg-dark-card dark:text-white focus:outline-none focus:ring-2 focus:ring-primary"
                            autocomplete="off"
                        >
                    </div>
                </div>
                <button 
                    type="submit" 
                    class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-opacity-90 transition flex items-center justify-center"
                >
                    <i class="fas fa-search mr-2"></i>
                    Get Weather
                </button>
            </form>

            <div id="search-suggestions" class="mt-1 bg-white dark:bg-dark-card rounded-lg shadow-lg absolute z-10 w-[calc(100%-3rem)] md:w-[calc(100%-12rem-3rem)] max-w-3xl hidden">
                <!-- Suggestions will be inserted here -->
            </div>
        </div>

        <!-- Loading indicator -->
        <div id="loading" class="text-center py-12 hidden">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
            <p class="mt-4 text-gray-600 dark:text-gray-400">Fetching weather data...</p>
        </div>

        <!-- Error message -->
        <div id="error-message" class="bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 p-4 rounded-lg mb-8 hidden">
            <div class="flex items-start">
                <i class="fas fa-exclamation-circle mt-1 mr-3"></i>
                <div id="error-text">Unable to fetch weather data. Please try again.</div>
            </div>
        </div>

        <!-- Offline warning -->
        <div id="offline-warning" class="bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 p-4 rounded-lg mb-8 hidden">
            <div class="flex items-start">
                <i class="fas fa-wifi-slash mt-1 mr-3"></i>
                <div>You are currently offline. Some features may be limited. Displaying cached data if available.</div>
            </div>
        </div>

        <!-- Weather alert banner -->
        <div id="weather-alert" class="bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 p-4 rounded-lg mb-8 hidden">
            <div class="flex items-start">
                <i class="fas fa-exclamation-triangle mt-1 mr-3"></i>
                <div>
                    <h3 class="font-bold" id="alert-title">Weather Alert</h3>
                    <p id="alert-description">There are currently no weather alerts for this location.</p>
                </div>
            </div>
        </div>

        <!-- Weather info -->
        <div id="weather-container" class="hidden">
            <!-- Current weather -->
            <div class="bg-white dark:bg-dark-card rounded-lg shadow-md overflow-hidden mb-8">
                <div class="p-6">
                    <div class="flex flex-col md:flex-row items-center md:items-start justify-between">
                        <div class="text-center md:text-left mb-6 md:mb-0">
                            <div class="flex items-center mb-2">
                                <h2 id="location-name" class="text-2xl font-bold">--</h2>
                                <button id="favorite-btn" class="ml-2 text-gray-400 hover:text-yellow-500 transition">
                                    <i class="far fa-star"></i>
                                </button>
                            </div>
                            <div class="flex items-center text-gray-600 dark:text-gray-400 mb-4">
                                <i class="fas fa-calendar-alt mr-2"></i>
                                <p id="current-date">--</p>
                                <span class="mx-2">•</span>
                                <span id="local-time">--:--</span>
                            </div>
                            <div class="flex flex-col md:flex-row md:items-center">
                                <div id="current-weather-icon" class="text-6xl text-primary mb-2 md:mb-0 md:mr-4">
                                    <i class="fas fa-cloud"></i>
                                </div>
                                <div>
                                    <div class="flex items-center justify-center md:justify-start">
                                        <span id="current-temp" class="text-5xl font-bold">--</span>
                                        <span class="text-2xl ml-1 mr-2">°C</span>
                                        <span id="feels-like" class="text-sm text-gray-600 dark:text-gray-400">Feels like: --°C</span>
                                    </div>
                                    <p id="weather-description" class="text-lg text-gray-700 dark:text-gray-300">--</p>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-center">
                            <div class="bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                                <i class="fas fa-wind text-blue-500 mb-2"></i>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Wind</p>
                                <p id="wind-speed" class="font-semibold">-- km/h</p>
                                <p id="wind-direction" class="text-xs text-gray-500">--</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                                <i class="fas fa-tint text-blue-500 mb-2"></i>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Humidity</p>
                                <p id="humidity" class="font-semibold">--%</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                                <i class="fas fa-eye text-blue-500 mb-2"></i>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Visibility</p>
                                <p id="visibility" class="font-semibold">-- km</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                                <i class="fas fa-temperature-low text-blue-500 mb-2"></i>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Min Temp</p>
                                <p id="min-temp" class="font-semibold">--°C</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                                <i class="fas fa-temperature-high text-blue-500 mb-2"></i>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Max Temp</p>
                                <p id="max-temp" class="font-semibold">--°C</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                                <i class="fas fa-cloud-rain text-blue-500 mb-2"></i>
                                <p class="text-xs text-gray-600 dark:text-gray-400">Precipitation</p>
                                <p id="precipitation" class="font-semibold">-- mm</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sun & Moon info -->
                <div class="border-t border-gray-200 dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-800/30">
                    <div class="flex flex-wrap justify-around gap-4">
                        <div class="flex items-center">
                            <i class="fas fa-sun text-yellow-500 mr-2"></i>
                            <div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Sunrise</div>
                                <div id="sunrise-time" class="font-medium">--:--</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-moon text-blue-300 mr-2"></i>
                            <div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Sunset</div>
                                <div id="sunset-time" class="font-medium">--:--</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-cloud-sun text-primary mr-2"></i>
                            <div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">UV Index</div>
                                <div id="uv-index" class="font-medium">--</div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-lungs text-green-500 mr-2"></i>
                            <div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Air Quality</div>
                                <div id="air-quality" class="font-medium">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab navigation for forecasts -->
            <div class="mb-6 flex border-b border-gray-200 dark:border-gray-700">
                <button id="daily-tab" class="px-4 py-2 border-b-2 border-primary text-primary font-medium">7-Day Forecast</button>
                <button id="hourly-tab" class="px-4 py-2 border-b-2 border-transparent hover:text-gray-700 dark:hover:text-gray-300">Hourly Forecast</button>
                <button id="details-tab" class="px-4 py-2 border-b-2 border-transparent hover:text-gray-700 dark:hover:text-gray-300">Weather Details</button>
                <button id="map-tab" class="px-4 py-2 border-b-2 border-transparent hover:text-gray-700 dark:hover:text-gray-300">Weather Maps</button>
            </div>

            <!-- Tab content -->
            <div class="tab-content mb-8">
                <!-- 7-day forecast tab -->
                <div id="daily-content" class="tab-pane">
                    <div class="grid grid-cols-2 md:grid-cols-7 gap-4" id="forecast-container">
                        <!-- Forecast cards will be inserted here -->
                    </div>
                </div>

                <!-- Hourly forecast tab -->
                <div id="hourly-content" class="tab-pane hidden">
                    <div class="bg-white dark:bg-dark-card rounded-lg shadow-md p-4 overflow-x-auto">
                        <div class="flex space-x-6 min-w-max" id="hourly-forecast">
                            <!-- Hourly forecast items will be inserted here -->
                        </div>
                    </div>
                    
                    <!-- Precipitation Probability Chart -->
                    <div class="mt-6 bg-white dark:bg-dark-card rounded-lg shadow-md p-4">
                        <h3 class="text-lg font-semibold mb-3">Precipitation Probability (48h)</h3>
                        <div class="h-48 bg-gray-50 dark:bg-gray-800 rounded-lg p-4" id="precipitation-chart">
                            <canvas id="precipitation-canvas"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Weather details tab -->
                <div id="details-content" class="tab-pane hidden">
                    <div class="bg-white dark:bg-dark-card rounded-lg shadow-md p-6">
                        <h3 class="text-xl font-semibold mb-4">Detailed Weather Information</h3>
                        
                        <!-- Air Quality Section -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3">Air Quality</h4>
                            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                                <div class="flex flex-wrap gap-4">
                                    <div class="flex-1 min-w-[120px]">
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">AQI Level</div>
                                        <div id="aqi-level" class="text-lg font-medium">--</div>
                                        <div id="aqi-description" class="text-sm">--</div>
                                    </div>
                                    <div class="flex-1 min-w-[120px]">
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">PM2.5</div>
                                        <div id="pm25" class="text-lg font-medium">-- µg/m³</div>
                                    </div>
                                    <div class="flex-1 min-w-[120px]">
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">PM10</div>
                                        <div id="pm10" class="text-lg font-medium">-- µg/m³</div>
                                    </div>
                                    <div class="flex-1 min-w-[120px]">
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Ozone (O₃)</div>
                                        <div id="ozone" class="text-lg font-medium">-- µg/m³</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sun & Moon Section -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3">Sun & Moon</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                                    <h5 class="text-md font-medium mb-2">Sun</h5>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Sunrise</span>
                                            <span id="details-sunrise" class="font-medium">--:--</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Sunset</span>
                                            <span id="details-sunset" class="font-medium">--:--</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Daylight</span>
                                            <span id="daylight-hours" class="font-medium">-- hrs -- min</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">UV Index</span>
                                            <span id="details-uv" class="font-medium">--</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                                    <h5 class="text-md font-medium mb-2">Moon</h5>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Moon Phase</span>
                                            <span id="moon-phase" class="font-medium">--</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Moonrise</span>
                                            <span id="moonrise-time" class="font-medium">--:--</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Moonset</span>
                                            <span id="moonset-time" class="font-medium">--:--</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Illumination</span>
                                            <span id="moon-illumination" class="font-medium">--%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Wind & Pressure Section -->
                        <div>
                            <h4 class="text-lg font-medium mb-3">Wind & Pressure</h4>
                            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Wind Speed</div>
                                        <div id="details-wind-speed" class="text-lg font-medium">-- km/h</div>
                                        <div id="details-wind-direction" class="text-sm">--</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Pressure</div>
                                        <div id="pressure" class="text-lg font-medium">-- hPa</div>
                                        <div id="pressure-trend" class="text-sm">--</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Dew Point</div>
                                        <div id="dew-point" class="text-lg font-medium">--°C</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Map tab -->
                <div id="map-content" class="tab-pane hidden">
                    <div class="bg-white dark:bg-dark-card rounded-lg shadow-md overflow-hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex flex-wrap gap-2">
                                <button class="map-type-btn px-3 py-1 bg-primary text-white rounded" data-type="temperature">Temperature</button>
                                <button class="map-type-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded" data-type="precipitation">Precipitation</button>
                                <button class="map-type-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded" data-type="wind">Wind</button>
                                <button class="map-type-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded" data-type="clouds">Clouds</button>
                                <button class="map-type-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded" data-type="pressure">Pressure</button>
                            </div>
                        </div>
                        <div id="map-container" class="h-[400px] bg-gray-200 dark:bg-gray-700 relative">
                            <div id="map-placeholder" class="w-full h-full flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fas fa-map-marked-alt text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-gray-500 dark:text-gray-400">Weather map loading...</p>
                                </div>
                            </div>
                            <div id="map-content-display" class="w-full h-full hidden">
                                <!-- Weather map will be displayed here -->
                                <img id="map-image" class="w-full h-full object-cover" src="" alt="Weather map">
                            </div>
                            <div class="absolute bottom-4 right-4 z-10">
                                <div class="bg-white dark:bg-dark-card rounded shadow p-2 text-xs">
                                    Data provided by <a href="#" class="text-primary">Open-Meteo</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compare Weather with Other Cities -->
            <div class="bg-white dark:bg-dark-card rounded-lg shadow-md p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Compare Weather</h3>
                    <button id="add-city-btn" class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-opacity-90 transition text-sm">
                        <i class="fas fa-plus mr-1"></i> Add City
                    </button>
                </div>
                <div id="compare-cities" class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="bg-gray-50 dark:bg-gray-800 text-left">
                                <th class="p-3">City</th>
                                <th class="p-3">Temp</th>
                                <th class="p-3">Condition</th>
                                <th class="p-3">Wind</th>
                                <th class="p-3">Humidity</th>
                                <th class="p-3">Precipitation</th>
                                <th class="p-3"></th>
                            </tr>
                        </thead>
                        <tbody id="compare-table-body">
                            <tr>
                                <td colspan="7" class="p-4 text-center text-gray-500 dark:text-gray-400">
                                    Add cities to compare weather conditions
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recent searches and popular cities -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
            <div class="bg-white dark:bg-dark-card rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Recent Searches</h3>
                    <button id="clear-recent" class="text-sm text-gray-500 hover:text-primary transition">Clear All</button>
                </div>
                <div id="recent-searches" class="space-y-2">
                    <p class="text-gray-500 dark:text-gray-400 text-sm">Your recent search locations will appear here</p>
                </div>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Popular Cities</h3>
                    <div class="text-sm text-gray-500 dark:text-gray-400">
                        <i class="fas fa-globe-americas mr-1"></i> Worldwide
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button class="popular-city-btn text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-city="Tokyo">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>Tokyo
                    </button>
                    <button class="popular-city-btn text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-city="New York">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>New York
                    </button>
                    <button class="popular-city-btn text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-city="London">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>London
                    </button>
                    <button class="popular-city-btn text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-city="Paris">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>Paris
                    </button>
                    <button class="popular-city-btn text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-city="Singapore">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>Singapore
                    </button>
                    <button class="popular-city-btn text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-city="Sydney">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>Sydney
                    </button>
                    <button class="popular-city-btn text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-city="Dubai">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>Dubai
                    </button>
                    <button class="popular-city-btn text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition" data-city="Rio de Janeiro">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>Rio de Janeiro
                    </button>
                </div>
            </div>
        </div>

        <!-- Add City Modal -->
        <div id="add-city-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-dark-card rounded-lg shadow-lg max-w-md w-full mx-4">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <h3 class="text-lg font-semibold">Add City for Comparison</h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4">
                    <input type="text" id="compare-city-input" placeholder="Enter city name" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-base bg-white dark:bg-dark-card dark:text-white focus:outline-none focus:ring-2 focus:ring-primary mb-4">
                    <div id="compare-suggestions" class="max-h-48 overflow-y-auto mb-4 hidden">
                        <!-- Suggestions will be populated here -->
                    </div>
                    <div class="flex justify-end">
                        <button id="cancel-add-city" class="px-4 py-2 text-gray-700 dark:text-gray-300 mr-2">Cancel</button>
                        <button id="confirm-add-city" class="px-4 py-2 bg-primary text-white rounded-lg" disabled>Add</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-500 dark:text-gray-400 text-sm">
            <p>Ryzxell &copy; 2025</p>
            <p class="mt-1">Powered by Open-Meteo API</p>
            <div class="mt-4 flex justify-center space-x-4">
                <a href="https://twitter.com" class="hover:text-primary transition"><i class="fab fa-twitter"></i></a>
                <a href="https://facebook.com" class="hover:text-primary transition"><i class="fab fa-facebook"></i></a>
                <a href="https://instagram.com/genshinimpact" class="hover:text-primary transition"><i class="fab fa-instagram"></i></a>
                <a href="https://github.com" class="hover:text-primary transition"><i class="fab fa-github"></i></a>
            </div>
            <div class="mt-4 space-x-3">
                <a href="#" class="text-gray-500 hover:text-primary transition">Privacy Policy</a>
                <span>|</span>
                <a href="#" class="text-gray-500 hover:text-primary transition">Terms of Service</a>
                <span>|</span>
                <a href="#" class="text-gray-500 hover:text-primary transition">Contact Us</a>
            </div>
        </footer>
    </div>

    <!-- Add Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Main JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchForm = document.getElementById('search-form');
            const locationInput = document.getElementById('location-input');
            const searchSuggestions = document.getElementById('search-suggestions');
            const loadingIndicator = document.getElementById('loading');
            const errorMessage = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            const weatherContainer = document.getElementById('weather-container');
            const offlineWarning = document.getElementById('offline-warning');
            const weatherAlert = document.getElementById('weather-alert');
            const locationName = document.getElementById('location-name');
            const localTime = document.getElementById('local-time');
            const currentDate = document.getElementById('current-date');
            const currentTemp = document.getElementById('current-temp');
            const feelsLike = document.getElementById('feels-like');
            const weatherDescription = document.getElementById('weather-description');
            const currentWeatherIcon = document.getElementById('current-weather-icon');
            const windSpeed = document.getElementById('wind-speed');
            const windDirection = document.getElementById('wind-direction');
            const humidity = document.getElementById('humidity');
            const visibility = document.getElementById('visibility');
            const minTemp = document.getElementById('min-temp');
            const maxTemp = document.getElementById('max-temp');
            const precipitation = document.getElementById('precipitation');
            const sunriseTime = document.getElementById('sunrise-time');
            const sunsetTime = document.getElementById('sunset-time');
            const uvIndex = document.getElementById('uv-index');
            const airQuality = document.getElementById('air-quality');
            const forecastContainer = document.getElementById('forecast-container');
            const hourlyForecast = document.getElementById('hourly-forecast');
            const recentSearchesContainer = document.getElementById('recent-searches');
            const popularCityBtns = document.querySelectorAll('.popular-city-btn');
            const locationBtn = document.getElementById('location-btn');
            const shareBtn = document.getElementById('share-btn');
            const toggleModeBtn = document.getElementById('toggle-mode');
            const favoriteBtn = document.getElementById('favorite-btn');
            const clearRecentBtn = document.getElementById('clear-recent');
            const compareCitiesTable = document.getElementById('compare-table-body');
            const addCityBtn = document.getElementById('add-city-btn');
            const addCityModal = document.getElementById('add-city-modal');
            const closeModalBtn = document.getElementById('close-modal');
            const cancelAddCityBtn = document.getElementById('cancel-add-city');
            const compareCityInput = document.getElementById('compare-city-input');
            const compareSuggestions = document.getElementById('compare-suggestions');
            const confirmAddCityBtn = document.getElementById('confirm-add-city');
            const dailyTab = document.getElementById('daily-tab');
            const hourlyTab = document.getElementById('hourly-tab');
            const detailsTab = document.getElementById('details-tab');
            const mapTab = document.getElementById('map-tab');
            const dailyContent = document.getElementById('daily-content');
            const hourlyContent = document.getElementById('hourly-content');
            const detailsContent = document.getElementById('details-content');
            const mapContent = document.getElementById('map-content');
            const mapTypeBtns = document.querySelectorAll('.map-type-btn');
            const mapImage = document.getElementById('map-image');
            const mapPlaceholder = document.getElementById('map-placeholder');
            const mapContentDisplay = document.getElementById('map-content-display');
            const installAppBtn = document.getElementById('install-app-btn');
            const pwaInstallBanner = document.getElementById('pwa-install-banner');
            const pwaInstallBtn = document.getElementById('pwa-install');
            const pwaCancelBtn = document.getElementById('pwa-cancel');
            
            // Store data for PWA
            let deferredPrompt;
            let favoriteLocations = [];
            let recentSearches = [];
            let compareCities = [];
            let currentLocation = null;
            let currentWeatherData = null;
            let selectedMapType = 'temperature';
            let selectedCity = null;
            
            // Weather codes mapping to icons
            const weatherIcons = {
                0: '<i class="fas fa-sun text-yellow-500"></i>', // Clear sky
                1: '<i class="fas fa-sun text-yellow-500"></i>', // Mainly clear
                2: '<i class="fas fa-cloud-sun text-yellow-400"></i>', // Partly cloudy
                3: '<i class="fas fa-cloud text-gray-400"></i>', // Overcast
                45: '<i class="fas fa-smog text-gray-500"></i>', // Fog
                48: '<i class="fas fa-smog text-gray-500"></i>', // Depositing rime fog
                51: '<i class="fas fa-cloud-rain text-blue-300"></i>', // Light drizzle
                53: '<i class="fas fa-cloud-rain text-blue-400"></i>', // Moderate drizzle
                55: '<i class="fas fa-cloud-rain text-blue-500"></i>', // Dense drizzle
                56: '<i class="fas fa-cloud-rain text-blue-300"></i>', // Light freezing drizzle
                57: '<i class="fas fa-cloud-rain text-blue-400"></i>', // Dense freezing drizzle
                61: '<i class="fas fa-cloud-rain text-blue-400"></i>', // Slight rain
                63: '<i class="fas fa-cloud-rain text-blue-500"></i>', // Moderate rain
                65: '<i class="fas fa-cloud-showers-heavy text-blue-600"></i>', // Heavy rain
                66: '<i class="fas fa-cloud-rain text-blue-400"></i>', // Light freezing rain
                67: '<i class="fas fa-cloud-rain text-blue-500"></i>', // Heavy freezing rain
                71: '<i class="fas fa-snowflake text-blue-200"></i>', // Slight snow fall
                73: '<i class="fas fa-snowflake text-blue-300"></i>', // Moderate snow fall
                75: '<i class="fas fa-snowflake text-blue-400"></i>', // Heavy snow fall
                77: '<i class="fas fa-snowflake text-blue-300"></i>', // Snow grains
                80: '<i class="fas fa-cloud-rain text-blue-400"></i>', // Slight rain showers
                81: '<i class="fas fa-cloud-rain text-blue-500"></i>', // Moderate rain showers
                82: '<i class="fas fa-cloud-showers-heavy text-blue-600"></i>', // Violent rain showers
                85: '<i class="fas fa-snowflake text-blue-300"></i>', // Slight snow showers
                86: '<i class="fas fa-snowflake text-blue-400"></i>', // Heavy snow showers
                95: '<i class="fas fa-bolt text-yellow-500"></i>', // Thunderstorm
                96: '<i class="fas fa-bolt text-yellow-500"></i>', // Thunderstorm with slight hail
                99: '<i class="fas fa-bolt text-yellow-500"></i>'  // Thunderstorm with heavy hail
            };
            
            const weatherDescriptions = {
                0: "Clear sky",
                1: "Mainly clear",
                2: "Partly cloudy",
                3: "Overcast",
                45: "Fog",
                48: "Depositing rime fog",
                51: "Light drizzle",
                53: "Moderate drizzle",
                55: "Dense drizzle",
                56: "Light freezing drizzle",
                57: "Dense freezing drizzle",
                61: "Slight rain",
                63: "Moderate rain",
                65: "Heavy rain",
                66: "Light freezing rain",
                67: "Heavy freezing rain",
                71: "Light snow fall",
                73: "Moderate snow fall",
                75: "Heavy snow fall",
                77: "Snow grains",
                80: "Slight rain showers",
                81: "Moderate rain showers",
                82: "Violent rain showers",
                85: "Slight snow showers",
                86: "Heavy snow showers",
                95: "Thunderstorm",
                96: "Thunderstorm with slight hail",
                99: "Thunderstorm with heavy hail"
            };
            
            // UV Index levels
            const uvLevels = {
                0: { level: "Low", color: "text-green-500" },
                1: { level: "Low", color: "text-green-500" },
                2: { level: "Low", color: "text-green-500" },
                3: { level: "Moderate", color: "text-yellow-500" },
                4: { level: "Moderate", color: "text-yellow-500" },
                5: { level: "Moderate", color: "text-yellow-500" },
                6: { level: "High", color: "text-orange-500" },
                7: { level: "High", color: "text-orange-500" },
                8: { level: "Very High", color: "text-red-500" },
                9: { level: "Very High", color: "text-red-500" },
                10: { level: "Extreme", color: "text-purple-500" },
                11: { level: "Extreme", color: "text-purple-500" }
            };
            
            // Air Quality Index levels
            const aqiLevels = {
                1: { level: "Good", description: "Air quality is satisfactory", color: "text-green-500" },
                2: { level: "Fair", description: "Air quality is acceptable", color: "text-yellow-500" },
                3: { level: "Moderate", description: "Unhealthy for sensitive groups", color: "text-orange-500" },
                4: { level: "Poor", description: "Health effects can be expected", color: "text-red-500" },
                5: { level: "Very Poor", description: "Health warnings of emergency", color: "text-purple-500" }
            };
            
            // Wind direction formatter
            function getWindDirection(degrees) {
                const directions = ["N", "NNE", "NE", "ENE", "E", "ESE", "SE", "SSE", "S", "SSW", "SW", "WSW", "W", "WNW", "NW", "NNW", "N"];
                return directions[Math.round(degrees / 22.5)];
            }
            
            // Format date
            function formatDate(date) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(date).toLocaleDateString(undefined, options);
            }
            
            // Format day of week
            function formatDay(date) {
                return new Date(date).toLocaleDateString(undefined, { weekday: 'short' });
            }
            
            // Format hour
            function formatHour(timeString) {
                const hour = parseInt(timeString.split(':')[0]);
                return hour > 12 ? `${hour - 12}PM` : hour === 0 ? '12AM' : hour === 12 ? '12PM' : `${hour}AM`;
            }
            
            // Format time
            function formatTime(dateTimeString) {
                if (!dateTimeString) return '--:--';
                const time = new Date(dateTimeString);
                return time.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
            }
            
            // Check if online
            function isOnline() {
                return navigator.onLine;
            }
            
            // Update online status display
            function updateOnlineStatus() {
                if (isOnline()) {
                    offlineWarning.classList.add('hidden');
                } else {
                    offlineWarning.classList.remove('hidden');
                }
            }
            
            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    // Create inline service worker since we can't reference external files
                    const swContent = `
                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open('weather-app-v1').then((cache) => {
                                    return cache.addAll([
                                        '/',
                                        'index.html',
                                        'https://cdn.tailwindcss.com',
                                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                                        'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js'
                                    ]);
                                })
                            );
                        });

                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request).then((response) => {
                                    return response || fetch(event.request).then((fetchResponse) => {
                                        // Don't cache API calls
                                        if (event.request.url.includes('api.open-meteo.com') || 
                                            event.request.url.includes('geocoding-api.open-meteo.com')) {
                                            return fetchResponse;
                                        }
                                        
                                        // Cache other resources
                                        return caches.open('weather-app-v1').then((cache) => {
                                            cache.put(event.request, fetchResponse.clone());
                                            return fetchResponse;
                                        });
                                    });
                                }).catch(() => {
                                    // Return a fallback for offline images
                                    if (event.request.url.match(/\.(jpg|png|gif|svg)$/)) {
                                        return new Response('<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg"><rect width="400" height="300" fill="#cccccc"/><text x="50%" y="50%" font-family="Arial" text-anchor="middle" dominant-baseline="middle" fill="#888888">Image Not Available Offline</text></svg>', 
                                            { headers: { 'Content-Type': 'image/svg+xml' } });
                                    }
                                })
                            );
                        });
                    `;
                    
                    const blob = new Blob([swContent], { type: 'text/javascript' });
                    const swUrl = URL.createObjectURL(blob);
                    
                    navigator.serviceWorker.register(swUrl).then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    }).catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
                });
            }
            
            // Create web manifest for PWA
            const manifestLink = document.querySelector('link[rel="manifest"]');
            if (manifestLink) {
                const manifestContent = {
                    "name": "Global Weather Forecast",
                    "short_name": "Weather App",
                    "description": "Get accurate real-time weather forecasts for any location worldwide",
                    "start_url": "/",
                    "display": "standalone",
                    "background_color": "#5D5CDE",
                    "theme_color": "#5D5CDE",
                    "icons": [
                        {
                            "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%235D5CDE' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z'/%3E%3C/svg%3E",
                            "sizes": "192x192",
                            "type": "image/svg+xml"
                        },
                        {
                            "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%235D5CDE' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z'/%3E%3C/svg%3E",
                            "sizes": "512x512",
                            "type": "image/svg+xml"
                        }
                    ]
                };
                const manifestBlob = new Blob([JSON.stringify(manifestContent)], {type: 'application/json'});
                const manifestURL = URL.createObjectURL(manifestBlob);
                manifestLink.href = manifestURL;
            }
            
            // Handle PWA install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installAppBtn.classList.remove('hidden');
                
                // Show install banner after 3 seconds
                setTimeout(() => {
                    if (deferredPrompt) {
                        pwaInstallBanner.classList.remove('hidden');
                        pwaInstallBanner.classList.add('transform-none');
                    }
                }, 3000);
            });
            
            // Handle installed app
            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed');
                deferredPrompt = null;
                pwaInstallBanner.classList.add('hidden');
                installAppBtn.classList.add('hidden');
            });
            
            // Install button click
            installAppBtn.addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        } else {
                            console.log('User dismissed the install prompt');
                        }
                        deferredPrompt = null;
                    });
                }
            });
            
            // PWA banner buttons
            pwaInstallBtn.addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                        pwaInstallBanner.classList.add('translate-y-full');
                        setTimeout(() => {
                            pwaInstallBanner.classList.add('hidden');
                        }, 300);
                    });
                }
            });
            
            pwaCancelBtn.addEventListener('click', () => {
                pwaInstallBanner.classList.add('translate-y-full');
                setTimeout(() => {
                    pwaInstallBanner.classList.add('hidden');
                }, 300);
            });
            
            // Online/offline status
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // Init online status check
            updateOnlineStatus();
            
            // Search for locations using the Geocoding API
            async function searchLocations(query, targetElement = searchSuggestions) {
                if (!query.trim()) return;
                
                try {
                    const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=5`);
                    const data = await response.json();
                    
                    targetElement.innerHTML = '';
                    
                    if (data.results && data.results.length > 0) {
                        data.results.forEach(result => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.className = 'px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
                            suggestionItem.innerHTML = `
                                <div class="font-medium">${result.name}</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">${result.country}${result.admin1 ? `, ${result.admin1}` : ''}</div>
                            `;
                            suggestionItem.addEventListener('click', () => {
                                if (targetElement === searchSuggestions) {
                                    locationInput.value = result.name;
                                    searchSuggestions.classList.add('hidden');
                                    getWeatherData(result.latitude, result.longitude, result.name, result.country);
                                } else if (targetElement === compareSuggestions) {
                                    selectedCity = {
                                        name: result.name,
                                        country: result.country,
                                        latitude: result.latitude,
                                        longitude: result.longitude
                                    };
                                    compareCityInput.value = result.name;
                                    compareSuggestions.classList.add('hidden');
                                    confirmAddCityBtn.disabled = false;
                                }
                            });
                            targetElement.appendChild(suggestionItem);
                        });
                        targetElement.classList.remove('hidden');
                    } else {
                        targetElement.classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Error searching for locations:', error);
                    targetElement.classList.add('hidden');
                }
            }
            
            // Get all weather data from Open-Meteo API
            async function getWeatherData(latitude, longitude, city, country) {
                showLoading();
                hideError();
                
                try {
                    // Fetch weather data
                    const weatherResponse = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}`+
                        `&hourly=temperature_2m,relativehumidity_2m,precipitation,weathercode,visibility,windspeed_10m,`+
                        `winddirection_10m,pressure_msl,apparent_temperature,precipitation_probability,uv_index`+
                        `&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum,sunrise,sunset,`+
                        `uv_index_max,precipitation_probability_max`+
                        `&current_weather=true&timezone=auto`
                    );
                    
                    if (!weatherResponse.ok) {
                        throw new Error('Weather API request failed');
                    }
                    
                    const weatherData = await weatherResponse.json();
                    
                    // Fetch air quality data
                    let airQualityData = null;
                    try {
                        const airQualityResponse = await fetch(
                            `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${latitude}&longitude=${longitude}`+
                            `&hourly=pm10,pm2_5,ozone&domains=cams_global`
                        );
                        if (airQualityResponse.ok) {
                            airQualityData = await airQualityResponse.json();
                        }
                    } catch (error) {
                        console.error('Air quality data fetch failed, continuing without it:', error);
                    }
                    
                    // Store the current location and weather data
                    currentLocation = { latitude, longitude, city, country };
                    currentWeatherData = { weather: weatherData, airQuality: airQualityData };
                    
                    // Display weather data
                    displayWeatherData(weatherData, airQualityData, city, country);
                    
                    // Update weather map
                    updateWeatherMap(latitude, longitude, selectedMapType);
                    
                    // Add to recent searches
                    addToRecentSearches(city, country, latitude, longitude);
                    
                } catch (error) {
                    console.error('Error fetching weather data:', error);
                    showError('Unable to fetch weather data. Please try again.');
                } finally {
                    hideLoading();
                }
            }
            
            // Update the weather map
            function updateWeatherMap(latitude, longitude, mapType) {
                // Show placeholder while loading
                mapPlaceholder.classList.remove('hidden');
                mapContentDisplay.classList.add('hidden');
                
                // Generate map URL - in a real app we'd use a mapping API
                // For this demo, we'll generate a placeholder map image
                const mockEndpoint = "https://images.unsplash.com/photo-1507608869274-d3177c8bb4c7?w=800&h=400";
                mapImage.src = mockEndpoint;
                
                // When image loads, hide placeholder
                mapImage.onload = function() {
                    mapPlaceholder.classList.add('hidden');
                    mapContentDisplay.classList.remove('hidden');
                };
                
                // Update map type buttons
                mapTypeBtns.forEach(btn => {
                    if (btn.dataset.type === mapType) {
                        btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                        btn.classList.add('bg-primary', 'text-white');
                    } else {
                        btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                        btn.classList.remove('bg-primary', 'text-white');
                    }
                });
            }
            
            // Display weather data in UI
            function displayWeatherData(data, airQualityData, city, country) {
                weatherContainer.classList.remove('hidden');
                
                // Current weather
                const current = data.current_weather;
                const currentWeatherCode = current.weathercode;
                
                locationName.textContent = country ? `${city}, ${country}` : city;
                currentDate.textContent = formatDate(current.time);
                
                // Update local time
                const localDateTime = new Date(current.time);
                localTime.textContent = localDateTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                // Update current weather display
                currentTemp.textContent = Math.round(current.temperature);
                weatherDescription.textContent = weatherDescriptions[currentWeatherCode] || 'Unknown';
                currentWeatherIcon.innerHTML = weatherIcons[currentWeatherCode] || '<i class="fas fa-cloud"></i>';
                
                // Find current hour index
                const currentHourIndex = data.hourly.time.findIndex(time => 
                    time.startsWith(current.time.split('T')[0])
                );
                
                // Update detailed weather info
                windSpeed.textContent = `${Math.round(current.windspeed)} km/h`;
                windDirection.textContent = getWindDirection(current.winddirection);
                humidity.textContent = `${data.hourly.relativehumidity_2m[currentHourIndex]}%`;
                visibility.textContent = `${(data.hourly.visibility[currentHourIndex] / 1000).toFixed(1)} km`;
                feelsLike.textContent = `Feels like: ${Math.round(data.hourly.apparent_temperature[currentHourIndex])}°C`;
                
                // Daily data
                minTemp.textContent = `${Math.round(data.daily.temperature_2m_min[0])}°C`;
                maxTemp.textContent = `${Math.round(data.daily.temperature_2m_max[0])}°C`;
                precipitation.textContent = `${data.daily.precipitation_sum[0]} mm`;
                
                // Sun and moon data
                sunriseTime.textContent = formatTime(data.daily.sunrise[0]);
                sunsetTime.textContent = formatTime(data.daily.sunset[0]);
                
                // UV Index
                const uvIndexValue = data.daily.uv_index_max[0];
                const uvInfo = uvLevels[Math.min(Math.floor(uvIndexValue), 11)];
                uvIndex.innerHTML = `${uvIndexValue} <span class="${uvInfo.color}">(${uvInfo.level})</span>`;
                
                // Air Quality (if available)
                if (airQualityData) {
                    // Simplified AQI calculation for demo
                    const pm25Value = airQualityData.hourly.pm2_5[currentHourIndex];
                    let aqiLevel = 1; // Default: Good
                    
                    if (pm25Value > 75) aqiLevel = 5;
                    else if (pm25Value > 35) aqiLevel = 4;
                    else if (pm25Value > 12) aqiLevel = 3;
                    else if (pm25Value > 6) aqiLevel = 2;
                    
                    const aqiInfo = aqiLevels[aqiLevel];
                    airQuality.innerHTML = `<span class="${aqiInfo.color}">${aqiInfo.level}</span>`;
                    
                    // Update air quality details in Details tab
                    document.getElementById('aqi-level').innerHTML = `<span class="${aqiInfo.color}">${aqiInfo.level}</span>`;
                    document.getElementById('aqi-description').textContent = aqiInfo.description;
                    document.getElementById('pm25').textContent = `${pm25Value.toFixed(1)} µg/m³`;
                    document.getElementById('pm10').textContent = `${airQualityData.hourly.pm10[currentHourIndex].toFixed(1)} µg/m³`;
                    document.getElementById('ozone').textContent = `${airQualityData.hourly.ozone[currentHourIndex].toFixed(1)} µg/m³`;
                } else {
                    airQuality.innerHTML = 'N/A';
                    document.getElementById('aqi-level').textContent = 'N/A';
                    document.getElementById('aqi-description').textContent = 'Air quality data not available';
                    document.getElementById('pm25').textContent = 'N/A';
                    document.getElementById('pm10').textContent = 'N/A';
                    document.getElementById('ozone').textContent = 'N/A';
                }
                
                // Weather Details tab
                document.getElementById('details-sunrise').textContent = formatTime(data.daily.sunrise[0]);
                document.getElementById('details-sunset').textContent = formatTime(data.daily.sunset[0]);
                
                // Calculate daylight hours
                const sunrise = new Date(data.daily.sunrise[0]);
                const sunset = new Date(data.daily.sunset[0]);
                const daylightMs = sunset - sunrise;
                const daylightHours = Math.floor(daylightMs / (1000 * 60 * 60));
                const daylightMinutes = Math.floor((daylightMs % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById('daylight-hours').textContent = `${daylightHours} hrs ${daylightMinutes} min`;
                
                document.getElementById('details-uv').innerHTML = `${uvIndexValue} <span class="${uvInfo.color}">(${uvInfo.level})</span>`;
                document.getElementById('details-wind-speed').textContent = `${Math.round(current.windspeed)} km/h`;
                document.getElementById('details-wind-direction').textContent = `${getWindDirection(current.winddirection)} (${Math.round(current.winddirection)}°)`;
                document.getElementById('pressure').textContent = `${Math.round(data.hourly.pressure_msl[currentHourIndex])} hPa`;
                
                // Calculate dew point (approximation)
                const temp = data.hourly.temperature_2m[currentHourIndex];
                const rh = data.hourly.relativehumidity_2m[currentHourIndex];
                const dewPoint = temp - ((100 - rh) / 5);
                document.getElementById('dew-point').textContent = `${Math.round(dewPoint)}°C`;
                
                // 7-day forecast
                forecastContainer.innerHTML = '';
                for (let i = 0; i < 7; i++) {
                    const forecastDay = document.createElement('div');
                    forecastDay.className = 'bg-white dark:bg-dark-card rounded-lg shadow-sm p-3 text-center';
                    forecastDay.innerHTML = `
                        <p class="font-medium">${i === 0 ? 'Today' : formatDay(data.daily.time[i])}</p>
                        <div class="text-3xl my-2">${weatherIcons[data.daily.weathercode[i]]}</div>
                        <div class="flex justify-center space-x-2">
                            <span class="font-bold">${Math.round(data.daily.temperature_2m_max[i])}°</span>
                            <span class="text-gray-500 dark:text-gray-400">${Math.round(data.daily.temperature_2m_min[i])}°</span>
                        </div>
                        <div class="mt-1 text-xs">
                            <i class="fas fa-cloud-rain text-blue-400 mr-1"></i>
                            <span>${data.daily.precipitation_probability_max[i]}%</span>
                        </div>
                    `;
                    forecastContainer.appendChild(forecastDay);
                }
                
                // Hourly forecast (for today and tomorrow)
                hourlyForecast.innerHTML = '';
                const startHour = new Date().getHours();
                const hourlyLimit = Math.min(startHour + 24, data.hourly.time.length);
                
                for (let i = startHour; i < hourlyLimit; i++) {
                    const time = data.hourly.time[i].split('T')[1];
                    const hourlyTemp = data.hourly.temperature_2m[i];
                    const hourlyWeatherCode = data.hourly.weathercode[i];
                    const precipProb = data.hourly.precipitation_probability[i];
                    
                    const hourlyItem = document.createElement('div');
                    hourlyItem.className = 'text-center flex flex-col items-center';
                    hourlyItem.innerHTML = `
                        <p class="text-sm text-gray-600 dark:text-gray-400">${formatHour(time)}</p>
                        <div class="text-xl my-2">${weatherIcons[hourlyWeatherCode]}</div>
                        <p class="font-bold">${Math.round(hourlyTemp)}°</p>
                        <p class="text-xs text-blue-500 mt-1">
                            <i class="fas fa-tint mr-1"></i>${precipProb}%
                        </p>
                    `;
                    hourlyForecast.appendChild(hourlyItem);
                }
                
                // Create precipitation chart
                createPrecipitationChart(data.hourly);
                
                // Update favorite button state
                updateFavoriteButton(city, country);
                
                // Check for weather alerts (simulated)
                checkForWeatherAlerts(data);
            }
            
            // Create precipitation probability chart
            function createPrecipitationChart(hourlyData) {
                const ctx = document.getElementById('precipitation-canvas').getContext('2d');
                const startHour = new Date().getHours();
                const labels = [];
                const precipData = [];
                
                for (let i = startHour; i < startHour + 48 && i < hourlyData.time.length; i++) {
                    const time = hourlyData.time[i].split('T')[1].substring(0, 5);
                    labels.push(time);
                    precipData.push(hourlyData.precipitation_probability[i]);
                }
                
                // Check if a chart already exists and destroy it
                if (window.precipChart) {
                    window.precipChart.destroy();
                }
                
                window.precipChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Precipitation %',
                            data: precipData,
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            },
                            x: {
                                display: true,
                                ticks: {
                                    maxRotation: 0,
                                    autoSkip: true,
                                    maxTicksLimit: 12
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // Check for weather alerts (simulated)
            function checkForWeatherAlerts(data) {
                const weatherCode = data.current_weather.weathercode;
                const maxTemp = data.daily.temperature_2m_max[0];
                const precipProb = data.hourly.precipitation_probability.slice(0, 24).reduce((max, val) => Math.max(max, val), 0);
                
                // Hide alert by default
                weatherAlert.classList.add('hidden');
                
                // Check for extreme conditions
                if (weatherCode >= 95) { // Thunderstorm
                    weatherAlert.classList.remove('hidden');
                    document.getElementById('alert-title').textContent = 'Thunderstorm Warning';
                    document.getElementById('alert-description').textContent = 'Severe thunderstorm activity expected in your area. Stay indoors and away from windows.';
                } else if ([71, 73, 75, 77, 85, 86].includes(weatherCode)) { // Heavy snow
                    weatherAlert.classList.remove('hidden');
                    document.getElementById('alert-title').textContent = 'Snow Advisory';
                    document.getElementById('alert-description').textContent = 'Significant snowfall expected. Travel may be difficult or hazardous.';
                } else if (weatherCode >= 65 || precipProb > 80) { // Heavy rain
                    weatherAlert.classList.remove('hidden');
                    document.getElementById('alert-title').textContent = 'Heavy Rain Alert';
                    document.getElementById('alert-description').textContent = 'Heavy rainfall may cause localized flooding in some areas.';
                } else if (maxTemp > 35) { // Extreme heat
                    weatherAlert.classList.remove('hidden');
                    document.getElementById('alert-title').textContent = 'Extreme Heat Advisory';
                    document.getElementById('alert-description').textContent = 'Dangerously high temperatures expected. Stay hydrated and avoid prolonged sun exposure.';
                }
            }
            
            // Update favorite button state
            function updateFavoriteButton(city, country) {
                const isFavorite = favoriteLocations.some(loc => 
                    loc.city === city && loc.country === country
                );
                
                if (isFavorite) {
                    favoriteBtn.innerHTML = '<i class="fas fa-star text-yellow-500"></i>';
                } else {
                    favoriteBtn.innerHTML = '<i class="far fa-star"></i>';
                }
            }
            
            // Add city to compare table
            function addCityToCompare(city, country, latitude, longitude) {
                // Check if already in comparison
                if (compareCities.some(c => c.city === city && c.country === country)) {
                    return;
                }
                
                // Add to compare cities array
                compareCities.push({ city, country, latitude, longitude });
                
                // Fetch weather data for comparison
                fetchComparisonWeatherData(city, country, latitude, longitude);
            }
            
            // Fetch weather data for comparison
            async function fetchComparisonWeatherData(city, country, latitude, longitude) {
                try {
                    const response = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=relativehumidity_2m,precipitation&daily=precipitation_sum&timezone=auto`
                    );
                    
                    if (!response.ok) {
                        throw new Error('Weather API request failed');
                    }
                    
                    const data = await response.json();
                    updateComparisonTable(city, country, data);
                    
                } catch (error) {
                    console.error('Error fetching comparison weather data:', error);
                }
            }
            
            // Update comparison table
            function updateComparisonTable(city, country, data) {
                // Clear "no cities" message if it exists
                if (compareCities.length === 1) {
                    compareCitiesTable.innerHTML = '';
                }
                
                // Find or create row
                let row = document.getElementById(`compare-row-${city.replace(/\s+/g, '-')}`);
                
                if (!row) {
                    row = document.createElement('tr');
                    row.id = `compare-row-${city.replace(/\s+/g, '-')}`;
                    compareCitiesTable.appendChild(row);
                }
                
                // Current weather data
                const current = data.current_weather;
                const currentWeatherCode = current.weathercode;
                
                // Find current hour index
                const currentHourIndex = data.hourly.time.findIndex(time => 
                    time.startsWith(current.time.split('T')[0])
                );
                
                // Update row content
                row.innerHTML = `
                    <td class="p-3">${city}${country ? `, ${country}` : ''}</td>
                    <td class="p-3 font-medium">${Math.round(current.temperature)}°C</td>
                    <td class="p-3">
                        <div class="flex items-center">
                            <span class="mr-2">${weatherIcons[currentWeatherCode]}</span>
                            <span>${weatherDescriptions[currentWeatherCode]}</span>
                        </div>
                    </td>
                    <td class="p-3">${Math.round(current.windspeed)} km/h</td>
                    <td class="p-3">${data.hourly.relativehumidity_2m[currentHourIndex]}%</td>
                    <td class="p-3">${data.daily.precipitation_sum[0]} mm</td>
                    <td class="p-3">
                        <button class="text-red-500 hover:text-red-700" onclick="removeComparison('${city}', '${country}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
            }
            
            // Remove city from comparison
            window.removeComparison = function(city, country) {
                // Remove from array
                compareCities = compareCities.filter(c => 
                    !(c.city === city && c.country === country)
                );
                
                // Remove from table
                const row = document.getElementById(`compare-row-${city.replace(/\s+/g, '-')}`);
                if (row) {
                    row.remove();
                }
                
                // Show empty message if no cities left
                if (compareCities.length === 0) {
                    compareCitiesTable.innerHTML = `
                        <tr>
                            <td colspan="7" class="p-4 text-center text-gray-500 dark:text-gray-400">
                                Add cities to cmpare weather conditions
                            </td>
                        </tr>
                    `;
                }
            };
            
            // Add to recent searches
            function addToRecentSearches(city, country, latitude, longitude) {
                const locationData = {
                    city,
                    country,
                    latitude,
                    longitude
                };
                
                // Check if already exists
                const existingIndex = recentSearches.findIndex(item => 
                    item.city === city && item.country === country
                );
                
                if (existingIndex !== -1) {
                    // Remove existing entry
                    recentSearches.splice(existingIndex, 1);
                }
                
                // Add to beginning of array
                recentSearches.unshift(locationData);
                
                // Keep only 5 most recent
                if (recentSearches.length > 5) {
                    recentSearches.pop();
                }
                
                // Update UI
                updateRecentSearchesUI();
            }
            
            // Update recent searches UI
            function updateRecentSearchesUI() {
                recentSearchesContainer.innerHTML = '';
                
                if (recentSearches.length === 0) {
                    recentSearchesContainer.innerHTML = `
                        <p class="text-gray-500 dark:text-gray-400 text-sm">Your recent search locations will appear here</p>
                    `;
                    return;
                }
                
                recentSearches.forEach(search => {
                    const searchItem = document.createElement('button');
                    searchItem.className = 'w-full text-left px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition flex items-center';
                    searchItem.innerHTML = `
                        <i class="fas fa-history text-gray-500 mr-2"></i>
                        <span>${search.city}${search.country ? `, ${search.country}` : ''}</span>
                    `;
                    searchItem.addEventListener('click', () => {
                        getWeatherData(search.latitude, search.longitude, search.city, search.country);
                    });
                    recentSearchesContainer.appendChild(searchItem);
                });
            }
            
            // Clear recent searches
            function clearRecentSearches() {
                recentSearches = [];
                updateRecentSearchesUI();
            }
            
            // Toggle favorite location
            function toggleFavorite(city, country, latitude, longitude) {
                const existingIndex = favoriteLocations.findIndex(loc => 
                    loc.city === city && loc.country === country
                );
                
                if (existingIndex !== -1) {
                    // Remove from favorites
                    favoriteLocations.splice(existingIndex, 1);
                } else {
                    // Add to favorites
                    favoriteLocations.push({ city, country, latitude, longitude });
                }
                
                // Update button state
                updateFavoriteButton(city, country);
            }
            
            // Get current location using geolocation API
            function getCurrentLocation() {
                if (navigator.geolocation) {
                    showLoading();
                    navigator.geolocation.getCurrentPosition(
                        async position => {
                            try {
                                // Reverse geocode to get city name
                                const lat = position.coords.latitude;
                                const lon = position.coords.longitude;
                                
                                const response = await fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}`);
                                const data = await response.json();
                                
                                if (data.features && data.features.length > 0) {
                                    const location = data.features[0].properties;
                                    getWeatherData(lat, lon, location.name, location.country);
                                } else {
                                    getWeatherData(lat, lon, "Current Location", "");
                                }
                            } catch (error) {
                                console.error('Error getting location name:', error);
                                getWeatherData(position.coords.latitude, position.coords.longitude, "Current Location", "");
                            }
                        },
                        error => {
                            hideLoading();
                            showError(`Unable to get your location: ${error.message}`);
                        }
                    );
                } else {
                    showError('Geolocation is not supported by your browser');
                }
            }
            
            // Share current weather
            function shareWeather() {
                if (!currentLocation) return;
                
                const shareText = `Weather in ${currentLocation.city}${currentLocation.country ? `, ${currentLocation.country}` : ''}: ${currentTemp.textContent}°C, ${weatherDescription.textContent}. Check it out!`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Weather Forecast',
                        text: shareText,
                        url: window.location.href
                    }).catch(error => {
                        console.error('Error sharing:', error);
                    });
                } else {
                    // Fallback for browsers that don't support Web Share API
                    alert('Share this weather forecast:\n\n' + shareText);
                }
            }
            
            // Show loading indicator
            function showLoading() {
                loadingIndicator.classList.remove('hidden');
            }
            
            // Hide loading indicator
            function hideLoading() {
                loadingIndicator.classList.add('hidden');
            }
            
            // Show error message
            function showError(message) {
                errorText.textContent = message;
                errorMessage.classList.remove('hidden');
            }
            
            // Hide error message
            function hideError() {
                errorMessage.classList.add('hidden');
            }
            
            // Toggle dark/light mode
            function toggleDarkMode() {
                document.documentElement.classList.toggle('dark');
            }
            
            // Tab switching
            function switchTab(tab) {
                // Remove active state from all tabs
                [dailyTab, hourlyTab, detailsTab, mapTab].forEach(t => {
                    t.classList.remove('border-primary', 'text-primary');
                    t.classList.add('border-transparent', 'hover:text-gray-700', 'dark:hover:text-gray-300');
                });
                
                // Hide all tab content
                [dailyContent, hourlyContent, detailsContent, mapContent].forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Set active tab and show content
                tab.classList.add('border-primary', 'text-primary');
                tab.classList.remove('border-transparent', 'hover:text-gray-700', 'dark:hover:text-gray-300');
                
                if (tab === dailyTab) {
                    dailyContent.classList.remove('hidden');
                } else if (tab === hourlyTab) {
                    hourlyContent.classList.remove('hidden');
                } else if (tab === detailsTab) {
                    detailsContent.classList.remove('hidden');
                } else if (tab === mapTab) {
                    mapContent.classList.remove('hidden');
                }
            }
            
            // Event listeners
            searchForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                searchSuggestions.classList.add('hidden');
                
                const query = locationInput.value.trim();
                if (!query) return;
                
                try {
                    const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1`);
                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        const location = data.results[0];
                        getWeatherData(location.latitude, location.longitude, location.name, location.country);
                    } else {
                        showError('Location not found. Please try a different city name.');
                    }
                } catch (error) {
                    console.error('Error searching for location:', error);
                    showError('Error searching for location. Please try again.');
                }
            });
            
            locationInput.addEventListener('input', function() {
                const query = this.value.trim();
                if (query.length >= 2) {
                    searchLocations(query);
                } else {
                    searchSuggestions.classList.add('hidden');
                }
            });
            
            compareCityInput.addEventListener('input', function() {
                const query = this.value.trim();
                if (query.length >= 2) {
                    searchLocations(query, compareSuggestions);
                } else {
                    compareSuggestions.classList.add('hidden');
                }
                
                // Disable confirm button if input is empty
                confirmAddCityBtn.disabled = true;
            });
            
            document.addEventListener('click', function(e) {
                if (!searchSuggestions.contains(e.target) && e.target !== locationInput) {
                    searchSuggestions.classList.add('hidden');
                }
                
                if (!compareSuggestions.contains(e.target) && e.target !== compareCityInput) {
                    compareSuggestions.classList.add('hidden');
                }
            });
            
            // Tab navigation
            dailyTab.addEventListener('click', () => switchTab(dailyTab));
            hourlyTab.addEventListener('click', () => switchTab(hourlyTab));
            detailsTab.addEventListener('click', () => switchTab(detailsTab));
            mapTab.addEventListener('click', () => switchTab(mapTab));
            
            // Map type buttons
            mapTypeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    selectedMapType = this.dataset.type;
                    if (currentLocation) {
                        updateWeatherMap(currentLocation.latitude, currentLocation.longitude, selectedMapType);
                    }
                });
            });
            
            // Toggle dark mode
            toggleModeBtn.addEventListener('click', toggleDarkMode);
            
            // Popular city buttons
            popularCityBtns.forEach(btn => {
                btn.addEventListener('click', async function() {
                    const city = this.dataset.city;
                    try {
                        const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1`);
                        const data = await response.json();
                        
                        if (data.results && data.results.length > 0) {
                            const location = data.results[0];
                            locationInput.value = location.name;
                            getWeatherData(location.latitude, location.longitude, location.name, location.country);
                        }
                    } catch (error) {
                        console.error('Error searching for popular city:', error);
                        showError('Error searching for location. Please try again.');
                    }
                });
            });
            
            // Get current location
            locationBtn.addEventListener('click', getCurrentLocation);
            
            // Share weather
            shareBtn.addEventListener('click', shareWeather);
            
            // Favorite button
            favoriteBtn.addEventListener('click', () => {
                if (currentLocation) {
                    toggleFavorite(
                        currentLocation.city,
                        currentLocation.country,
                        currentLocation.latitude,
                        currentLocation.longitude
                    );
                }
            });
            
            // Clear recent searches
            clearRecentBtn.addEventListener('click', clearRecentSearches);
            
            // Add city to compare
            addCityBtn.addEventListener('click', () => {
                addCityModal.classList.remove('hidden');
                compareCityInput.value = '';
                compareSuggestions.classList.add('hidden');
                confirmAddCityBtn.disabled = true;
            });
            
            // Modal close buttons
            closeModalBtn.addEventListener('click', () => {
                addCityModal.classList.add('hidden');
            });
            
            cancelAddCityBtn.addEventListener('click', () => {
                addCityModal.classList.add('hidden');
            });
            
            // Add city to comparison
            confirmAddCityBtn.addEventListener('click', () => {
                if (selectedCity) {
                    addCityToCompare(
                        selectedCity.name,
                        selectedCity.country,
                        selectedCity.latitude,
                        selectedCity.longitude
                    );
                    addCityModal.classList.add('hidden');
                    selectedCity = null;
                }
            });
            
            // Close modal when clicking outside
            addCityModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });
            
            // Load Tokyo as default on page load
            setTimeout(() => {
                document.querySelector('[data-city="Shenzhen"]').click();
            }, 500);
        });
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        // Service worker registration handled in main script
    </script>
</body>
</html>
